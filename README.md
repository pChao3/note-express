# note-express

这是一个基于语音驱动的智能笔记生成后端服务，旨在通过 AI 技术实现语音到结构化笔记的自动化转换。

## AudioInput

### 业务流程

项目核心的语音处理逻辑如下：
**根据语音输入 转base64 => 调用大模型音频识别（qwen3-asr-flash） => 写入prompt模版 定义结构化输出字段 调用大模型分析总结（qwen-plus） => 返回note笔记信息字段**

---

## 🛠 技术深度解析

### 1. 音频预处理 (Frontend)

- **录制**: 使用 MediaRecorder API 捕获音频。
- **转化**: 利用 FileReader 将 Blob 对象转换为 **Base64** 编码字符串。
- **传输**: 通过 JSON 载体将编码后的数据 POST 到后端。

### 2. 语音识别 (Qwen3-ASR-Flash)

- **极速响应**: 利用 `qwen3-asr-flash` 的低延迟特性，将 Base64 流实时或近实时转译为原始文本（Raw Text）。
- **兼容性**: 针对语音中的口语化表达进行初步校正。

### 3. 提示词工程 (Prompt Engineering)

- **逻辑注入**: 构造系统级 Prompt，引导 `qwen-plus` 进行角色扮演（笔记秘书）。
- **结构定义**: 强行约束模型仅输出 JSON 格式，

### 4. 语义总结 (Qwen-Plus)

- **深度理解**: `qwen-plus` 接收带文字的 Prompt，识别上下文语境、情感和任务目标。
- **结构化输出**: 将非结构化的转译文本映射到预定义的笔记信息字段中。

---

本项目核心的语音处理逻辑如下：

1. **语音采集与转换**：前端捕获用户语音，将其转换为 **Base64** 编码格式进行传输。
2. **音频识别 (ASR)**：调用 **qwen3-asr-flash** 模型，将 Base64 音频流极速转录为原始文本。
3. **Prompt 模版注入**：将转录出的文本填入预定义的 **Prompt 模版** 中。
4. **结构化定义**：在提示词中明确定义输出字段（如：标题、摘要、待办事项、关键词等）。
5. **分析总结 (LLM)**：调用 **qwen-plus** 大模型，根据模版要求对原始文本进行深度语义分析与总结。
6. **字段返回**：最终向前端返回处理后的 **note 笔记信息字段**。

---

## 📚 知识库增强 (RAG 实现)

为了提升笔记生成的专业度与上下文关联性，本项目集成了 **RAG (Retrieval-Augmented Generation)** 机制。当用户输入内容涉及特定知识领域时，系统会自动检索本地知识库进行补充。

### 1. 文档处理流水线

- **分割 (Chunking)**：采用递归字符分割器（Recursive Character Text Splitter），根据语义结构将原始文档拆分为 500-1000 字符的片段，并保持一定的重叠度（Overlap），确保上下文完整。
- **矢量化 (Embedding)**：使用阿里云 DashScope 的 **text-embedding-v4** 模型。该模型具有极高的语义捕捉能力，能将文本片段转化为高维向量。
- **存储**: 向量数据存储于轻量级向量数据库中，支持高效的空间检索。

### 2. 检索与决策逻辑

- **语义匹配**: 系统将用户输入的原始文本（Raw Text）同样通过 `text-embedding-v4` 转化为查询向量。
- **最大相似度判断**:
  - 计算查询向量与知识库中各片段向量的 **余弦相似度 (Cosine Similarity)**。
  - **阈值过滤**: 设置相似度阈值（如 `> 0.75`）。
  - **决策**: 若最大相似度超过阈值，系统将提取前 $K$ 个相关片段，作为背景知识（Context）注入到 Prompt 模板中；若未达到阈值，则仅根据文本内容进行总结。

  ### 3. 增强后的 Prompt 结构
  - 当触发 RAG 时，再将查询到的数据和问题写入Propmpt 发送给 `qwen-plus`进行总结输出。

## 🛠 技术栈

- **核心框架**: Node.js / Express
- **语音识别 (ASR)**: 阿里云 DashScope `qwen3-asr-flash`
- **语义分析 (LLM)**: 阿里云 DashScope `qwen-plus`
- **向量模型 (Embedding)**: 阿里云 DashScope `text-embedding-v4`
- **数据格式**: JSON / Vector
